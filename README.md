
# Translation Management Service

The Translation Management Service (<em>TMS</em>) provides a series of endpoints for the coordination of the document translation workflow, consisting of the <em>Formatting</em> and <em>Translation</em> microservices. 

... supported formats
## Outline

1. [Quick Start](#quick-start)
2. [Installation](#installation)
3. [Configuration](#configuration)
4. [Workflow](#workflow)
5. [Usage](#usage)
6. [Contribution](#contribution)
7. [Tentative Roadmap](#roadmap)
8. [Contacts](#contacts)
9. [License](#license)

## Quick Start
1. Given the application python package
   * ```pip install <local package>```
2. Start central Luigi scheduler, the core task runner for running the translation pipeline.
   * ```python main.py```


### Development
1. Clone the git repository
2. Install project dependencies
    * `python setup.py`
4. Run the development server
    * `python ./main.py`
        * This starts a web interface for uploading files to translate.
        * Interact with the Open API Documentation at **http://localhost:8204/api/**

### Production (single node)
1. Given the application python package
   * `pip install <local package>`
2. Run the server:
    * `python ./main.py --level production` file and run:
*Note*: If served on Windows, consider wrapping the above line in a Windows Service through [NSSM](https://www.nssm.cc). For example usage, go to the [usage section](#usage). If you require a package distribution, please contact the project authors.

#### SSL support:
Include the certificate and key files when starting the project.

Example:
* `python ./main.py --level production --key ./server.key --cert ./certificate.cert`

### Generate package

To generate a pip-installable package of the server for deployment, run `python setup.py sdist`. The resulting package will be generated in the "./dist" folder.

## Installation

1. Clone this repository to the working directory via ```git clone <repository link>```
2. Install Python dependencies. Pip is used in the example, but and alternatives are fine (e.g. Anaconda, easy_install).
   * (Optional) Create a python [virtual environment](http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/).
      * ```virtualenv TMS```
   * ```python setup.py```

##### Dependencies
* Python 3 
  * Pandas
  * Flask and flask utility libraries
      * Provides web interface for administrative REST API and file uploads.
  * Sqlalchemy
      * Python and SQL compatible ORM. 
  * Pyodbc
      *  SQL Server driver and connection management.
  * [Gevent](http://www.gevent.org/index.html)
    * Server code
  * **SQL Server**
    * Location configured in the package
 * (Optional)
   * [RabbitMQ](https://www.rabbitmq.com) messaging
   * [ELK](https://www.elastic.co/elk-stack) logging

#### OpenAPI
The hosted application also allows discovery of endpoints through a UI, hosted at **<hostname>/api**. 

## Configuration

The TMS supports configuration through the REST API. To begin processing, users must configure the processing directory.

### Processing
Processing settings can be changed through the **/admin/processing** endpoint through their respective verbs (i.e. GET, PUT, POST). Remember, when setting environment paths, to escape backslashes: (i.e. "\\test_directory\\" to "\\\test_directory\\\\"). The only property that <em>must</em> be defined is the **processing_dir**. This can be a shared disk between other services such as the Translation-Microservice.
* <em>processing_dir</em> corresponds to the working directory of the TMS. Files generated by the service will be saved here.

## Workflow
The TMS was build to support the potential for human translator involvement. In the TMS workflow, the machine translation is used to augment the human translation effort by generating the initial translation. Translators are then allowed to retrieve the XLIFF and review the translations. If changes are made, the XLIFF can be re-submitted, triggering the regeneration of the translated document in target format with the modified translations.

## Usage

Document translation requests are submitted via the REST API and monitored through polling various properties. All requests return a JSON resource that corresponds to the document translation request. Each resource holds the state of the request and additional metadata.

The key endpoints and their descriptions are listed below:
* **POST /docTranslate/**
    * The initial request to translate a document.
* **GET /docTranslate/{id}**
    * Retrieve the corresponding document translation request object. This is frequently used to poll for the completion of a translation job, indicated by the ```is_processing``` property or ```status``` object.
* **GET /docTranslate/{id}/xliff**
    * Retrieve the translated XLIFF file.
* **PUT /docTranslate/{id}/xliff**
    * Update the machine-translated XLIFF file with the human-edited version.
* **GET /docTranslate/{id}/formattedDoc**
    * Return the final translated document.

For further details, view the [Open API specification](OpenAPI).

---

## Contribution
Anyone is welcome to submit ideas and Pull Requests (e.g. "Merge Requests" in Gitlab) to this repository and activity is highly encouraged. Feel free to open up discussion on proposed changes prior to submitted for review to core contributors. 

## Contacts
Project lead: Naouel.Baili@iqvia.com
Development: Joseph.Munoz@iqvia.com

## License
Property of IQVIA (2018). Not for distribution. Internal use only.

## Roadmap
1. UI for TMS